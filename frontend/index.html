<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Tickets</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://unpkg.com/vue-router@4"></script>
  <style>
    /* Estilo Terminal Minimalista */
    body {
      background-color: #000;
      color: #0f0;
      font-family: 'Courier New', monospace;
      margin: 0;
      padding: 10px;
      line-height: 1.4;
      font-size: 14px;
    }

    #app {
      max-width: 700px;
      margin: 0 auto;
    }

    .container {
      border: 1px solid #0f0;
      padding: 15px;
      margin: 15px 0;
    }

    h1, h2, h3 {
      color: #0f0;
      margin: 0 0 10px 0;
      font-weight: normal;
    }

    input, textarea, select {
      background-color: #111;
      color: #0f0;
      border: 1px solid #0f0;
      padding: 5px;
      margin: 3px 0 10px 0;
      font-family: 'Courier New', monospace;
      width: 100%;
      box-sizing: border-box;
    }

    button {
      background-color: #111;
      color: #0f0;
      border: 1px solid #0f0;
      padding: 5px 10px;
      margin: 5px 0;
      font-family: 'Courier New', monospace;
      cursor: pointer;
      font-size: 13px;
    }

    button:hover {
      background-color: #0f0;
      color: #000;
    }

    .ticket {
      border-left: 3px solid #0f0;
      padding: 8px 12px;
      margin: 8px 0;
    }

    .ticket.high { border-left-color: #f00; }
    .ticket.medium { border-left-color: #ff0; }
    .ticket.low { border-left-color: #0f0; }

    .nav {
      display: flex;
      gap: 12px;
      padding: 8px 0;
      margin-bottom: 15px;
      border-bottom: 1px solid #0f0;
    }

    .nav a {
      color: #0f0;
      text-decoration: none;
      font-size: 13px;
    }

    .user {
      margin-left: auto;
      color: #0a0;
      font-size: 13px;
    }

    .status {
      display: inline-block;
      padding: 2px 5px;
      font-size: 12px;
    }

    .status.open { color: #0f0; }
    .status.in-progress { color: #ff0; }
    .status.closed { color: #f00; }

    .error { color: #f00; }
    .success { color: #0f0; }

    p {
      margin: 8px 0;
    }
  </style>
</head>
<body>
<div id="app">
  <nav class="nav" v-if="isAuthenticated">
    <router-link to="/tickets">Tickets</router-link>
    <router-link to="/new-ticket">Nuevo</router-link>
    <a href="#" @click="logout">Salir</a>
    <span class="user">{{ currentUser }}</span>
  </nav>

  <router-view></router-view>
</div>

<script>
  const { createApp } = Vue;
  const { createRouter, createWebHashHistory } = VueRouter;

  // Componente de Login
  const Login = {
    template: `
      <div class="container">
        <h1>Sistema de Tickets</h1>
        <h2>Login</h2>
        <form @submit.prevent="login">
          <div>
            <label>Usuario:</label>
            <input type="text" v-model="credentials.username" required>
          </div>
          <div>
            <label>Contraseña:</label>
            <input type="password" v-model="credentials.password" required>
          </div>
          <button type="submit">Ingresar</button>
        </form>
        <p>¿No tienes cuenta? <router-link to="/register">Regístrate</router-link></p>
        <p class="error" v-if="error">{{ error }}</p>
      </div>
    `,
    data() {
      return {
        credentials: {
          username: '',
          password: ''
        },
        error: ''
      }
    },
    methods: {
      async login() {
        try {
          if (this.credentials.username && this.credentials.password) {
            this.$store.commit('setAuth', true);
            this.$store.commit('setUser', this.credentials.username);
            localStorage.setItem('authToken', 'simulated-token');
            this.$router.push('/tickets');
          } else {
            this.error = 'Usuario y contraseña requeridos';
          }
        } catch (err) {
          this.error = 'Error en el login';
          console.error(err);
        }
      }
    }
  };

  // Componente de Registro
  const Register = {
    template: `
      <div class="container">
        <h2>Registro</h2>
        <form @submit.prevent="register">
          <div>
            <label>Usuario:</label>
            <input type="text" v-model="newUser.username" required>
          </div>
          <div>
            <label>Email:</label>
            <input type="email" v-model="newUser.email" required>
          </div>
          <div>
            <label>Contraseña:</label>
            <input type="password" v-model="newUser.password" required>
          </div>
          <div>
            <label>Confirmar:</label>
            <input type="password" v-model="newUser.confirmPassword" required>
          </div>
          <button type="submit">Registrarse</button>
        </form>
        <p>¿Ya tienes cuenta? <router-link to="/">Login</router-link></p>
        <p class="error" v-if="error">{{ error }}</p>
        <p class="success" v-if="success">{{ success }}</p>
      </div>
    `,
    data() {
      return {
        newUser: {
          username: '',
          email: '',
          password: '',
          confirmPassword: ''
        },
        error: '',
        success: ''
      }
    },
    methods: {
      async register() {
        if (this.newUser.password !== this.newUser.confirmPassword) {
          this.error = 'Las contraseñas no coinciden';
          return;
        }

        try {
          this.success = 'Registro exitoso. Redirigiendo...';
          setTimeout(() => {
            this.$router.push('/');
          }, 1000);
        } catch (err) {
          this.error = 'Error en el registro';
          console.error(err);
        }
      }
    }
  };

  // Componente de Lista de Tickets
  const TicketList = {
    template: `
      <div class="container">
        <h2>Tickets</h2>
        <div v-if="loading">Cargando...</div>
        <div v-else>
          <div v-for="ticket in tickets" :key="ticket.id" class="ticket" :class="ticket.priority">
            <h3>{{ ticket.title }}</h3>
            <p>{{ ticket.description }}</p>
            <div>
              <span class="status" :class="ticket.status">{{ ticket.status }}</span> |
              Prioridad: {{ ticket.priority }}
            </div>
            <button @click="viewTicket(ticket.id)">Detalles</button>
          </div>
        </div>
        <router-link to="/new-ticket">
          <button>Nuevo Ticket</button>
        </router-link>
      </div>
    `,
    data() {
      return {
        tickets: [],
        loading: true
      }
    },
    async created() {
      await this.fetchTickets();
    },
    methods: {
      async fetchTickets() {
        try {
          this.tickets = [
            {
              id: 1,
              title: 'Error en el servidor',
              description: 'El servidor no responde a solicitudes POST',
              status: 'open',
              priority: 'high',
              createdAt: new Date()
            },
            {
              id: 2,
              title: 'Actualizar docs',
              description: 'Faltan ejemplos en la API',
              status: 'in-progress',
              priority: 'medium',
              createdAt: new Date(Date.now() - 86400000)
            }
          ];
          this.loading = false;
        } catch (err) {
          console.error('Error al cargar tickets:', err);
          this.loading = false;
        }
      },
      viewTicket(id) {
        this.$router.push(`/ticket/${id}`);
      }
    }
  };

  // Store para estado global
  const store = {
    state() {
      return {
        isAuthenticated: localStorage.getItem('authToken') !== null,
        currentUser: localStorage.getItem('username') || ''
      }
    },
    mutations: {
      setAuth(state, isAuthenticated) {
        state.isAuthenticated = isAuthenticated;
      },
      setUser(state, username) {
        state.currentUser = username;
        localStorage.setItem('username', username);
      },
      logout(state) {
        state.isAuthenticated = false;
        state.currentUser = '';
        localStorage.removeItem('authToken');
        localStorage.removeItem('username');
      }
    }
  };

  // Configuración del router
  const router = createRouter({
    history: createWebHashHistory(),
    routes: [
      { path: '/', component: Login, meta: { requiresAuth: false } },
      { path: '/register', component: Register, meta: { requiresAuth: false } },
      { path: '/tickets', component: TicketList, meta: { requiresAuth: true } },
      { path: '/new-ticket', component: NewTicket, meta: { requiresAuth: true } },
      { path: '/ticket/:id', component: TicketDetail, meta: { requiresAuth: true } },
      { path: '/:pathMatch(.*)*', redirect: '/' }
    ]
  });

  // Guardia de navegación
  router.beforeEach((to, from, next) => {
    if (to.meta.requiresAuth && !store.state().isAuthenticated) {
      next('/');
    } else {
      next();
    }
  });

  // Creación de la aplicación
  const app = createApp({
    data() {
      return {
        currentUser: store.state().currentUser,
        isAuthenticated: store.state().isAuthenticated
      }
    },
    methods: {
      logout() {
        store.commit('logout');
        this.$router.push('/');
      }
    }
  });

  app.use(router);
  app.mount('#app');
</script>
</body>
</html>